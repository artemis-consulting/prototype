{% load url_tags %}
<div class="panel-group" role="tablist" aria-multiselectable="true">

    {% if events|length == 0 %}
        <p class="text-info">No results found for: {{ q|replace_plus_signs }}</p>
    {% else %}
        <span>{{ events_paginator.page_display }}</span>
        {% if events_paginator.pages > 1 %}
        <nav>
          <ul class="pagination pagination-sm">
              <li {% if events_paginator.has_previous %}{% else %}class="disabled"{% endif %}><a href="?q={{q}}&amp;pa    ge={{events_paginator.prev}}" class="prev">prev</a></li>

              {% for page_number in events_paginator.pagination_display %}

              {% ifequal page_number "..." %}
              <li><span>...</span></li>
              {% else %}
              {% ifequal page_number events_paginator.page %}
              <li class="disabled"><span>{{page_number}}</span></li>
              {% else %}
              <li><a href="?q={{q}}&amp;page={{page_number}}">{{page_number}}</a></li>
              {% endifequal %}
              {% endifequal %}
              {% endfor %}

              <li {% if events_paginator.has_next %}{% else %}class="disabled"{% endif %}><a href="?q={{q}}&amp;page={{events_paginator.next}}" class="next">next</a></li>
          </ul>
        </nav>
    {% endif %}
    {% endif %}

    {% for result in events %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a role="button" data-toggle="collapse" href="#{{ prefix }}_panel{{ forloop.counter }}" aria-expanded="false">
                        <i class="glyphicon glyphicon-menu-right"></i>
                        <i class="glyphicon glyphicon-menu-down" style="display:none;"></i>
                        Safety Report ID: {{ result.safety_data.safety_report }}
                    </a>
                </h4>
            </div>
            <div class="panel-collapse collapse" id="{{ prefix }}_panel{{ forloop.counter }}">
                <div class="panel-body">
                    <table class="table table-striped table-bordered">
                         <caption>Reporting Sources</caption>
                         <tbody>
                           {% for key, value in result.safety_data.items %}
                           {% if key != 'safety_report' %}
                           <tr>
                             <th scope="row">
                                 {{ key|replace_underscores|capfirst }}
                             </th>
                            <td>{% if value|is_list %}
                                    {% if key == 'seriousness_details' %}
                                      {% for val in value %}
                                        {{ val|default:"N/A"|format_yes }}<br />
                                      {% endfor %}
                                    {% else %}
                                      {% for val in value %}
                                        {{ val|default:"N/A" }}<br />
                                      {% endfor %}
                                    {% endif %}
                                {% else %}
                                    {{ value|default:"N/A" }}
                                {% endif %}
                            </td>
                           </tr>
                           {% endif %}
                           {% endfor %}
                         </tbody>
                    </table>
                    <table class="table table-striped table-bordered">
                        <caption>
                         Patient Data
                        </caption>
                        <tbody>
                           {% for key, value in result.patient_data.items %}
                           <tr>
                             <th scope="row">{{ key|replace_underscores|capfirst }}</th>
                             <td>{% if value|is_list %}
                                   {% for val in value %}
                                     {{ val|default:"N/A" }}<br />
                                   {% endfor %}
                                 {% else %}
                                   {{ value|default:"N/A" }}
                                 {% endif %}
                             </td>
                           </tr>
                           {% endfor %}
                        </tbody>
                    </table>
                    <table class="table table-striped table-bordered">
                        <caption>
                         Drug Data
                        </caption>
                        <tbody>
                       {% for label_data in result.label_data %}
                        <table class="table table-striped table-bordered">
                           {% for key, value in label_data.items %}
                           <tr>
                             <th scope="row">{{ key|replace_underscores|capfirst }}</th>
                             <td>
                                 {% if value|is_list %}
                                     {% for val in value %}
                                       {{ val|default:"N/A" }}<br />
                                     {% endfor %}
                                 {% else %}
                                     {{ value|default:"N/A" }}
                                 {% endif %}
                             </td>
                           </tr>
                           {% endfor %}
                        </table>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% endfor %}
</div>
